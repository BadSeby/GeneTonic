---
title: >
  Your report from `GeneTonic`
author:
- name: Your Name

output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: show
    code_download: true
    number_sections: true
    theme: lumen
---

# Intro

 <!-- this is the file that gets used in rendering the many outputs via happyhour -->

ideas:

- differentiate the content based on batch running vs generated at runtime?
- print out the values of input$... objects. So one can just repeat them ;)

These are the provided objects

```{r echo = TRUE}
library(GeneTonic)
```


```{r echo = TRUE}
dds
res_de
head(res_enrich)
head(annotation_obj)
res_enrich <- get_aggrscores(res_enrich, res_de, annotation_obj)
```


```{r}
values$mygenesets
```

```{r}
values$mygenes
```

```{r}
myids <- annotation_obj$gene_id[match(values$mygenes ,annotation_obj$gene_name)]
```


```{r}
lapply(myids, function(arg) {
  GeneTonic::gene_plot(dds,gene = arg,intgroup = "condition", 
                       annotation_obj = annotation_obj)})
```

# Something for the selected genesets

```{r}
corresponding_gs_ids <- res_enrich$gs_id[res_enrich$gs_description %in% values$mygenesets]
gs_mds(res_enrich, res_de, annotation_obj, gs_labels = corresponding_gs_ids)

gs_volcano(res_enrich, volcano_labels = 0, gs_labels = corresponding_gs_ids)
```

# Geneset content, tabbed! {.tabset .tabset-fade}

Here is a heatmap for each bookmarked set

```{r echo = TRUE, results="asis"}
corresponding_gs_ids <- res_enrich$gs_id[res_enrich$gs_description %in% values$mygenesets]
vst_macrophage <- DESeq2::vst(dds)

for (gs in values$mygenesets) {
  cat("## ", gs, "{-}\n")
  corresponding_gs_id <- res_enrich$gs_id[res_enrich$gs_description %in% gs]
  
  print(
    gs_heatmap(vst_macrophage, 
             res_de, 
             res_enrich, 
             annotation_obj, 
             geneset_id = corresponding_gs_id, 
             cluster_cols = TRUE)
  )
  
  cat(go_2_html(corresponding_gs_id, res_enrich))
  cat("\n\n")
}
```

# Something after that

lorem ipsum

```{r}
# enrichment map, interactive?
# ggs_graph?
```


# Session info {-}

```{r}
sessionInfo()
```

